<!DOCTYPE html>
<html lang="kr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="../images/logo.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/font.css">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <title>BetDAO</title>
</head>

<body>
<div id="menu-placeholder"></div>
<script>
  fetch('../dashboard.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('menu-placeholder').innerHTML = html;
      const script = document.createElement('script');
      script.src = '../src/topinfo.js';
      document.body.appendChild(script);
    });
</script>

<div class="container mt-4">

  <!-- ë³´ë¬¼ì°¾ê¸° ì•ˆë‚´ -->
  <div class="card mb-4">
    <div class="card-header"><h5>ë³´ë¬¼ì°¾ê¸° ì•ˆë‚´</h5></div>
    <div class="card-body">
      <p>ë ˆë²¨1 ì´ìƒì´ë©´ ëˆ„êµ¬ë‚˜ ì°¸ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <p>ì°¾ì€ ë³´ë¬¼ì„ êµí™˜í•˜ë©´ BUTì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <p>QRì„ ì¸ì‹í•˜ê±°ë‚˜ ìˆ˜ë™ ì…ë ¥ í›„ ë°•ìŠ¤ë¥¼ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <p>ë³´ë¬¼ë°•ìŠ¤ 1íšŒ ì˜¤í”ˆ ì‹œ 1BUT ì†Œëª¨ë©ë‹ˆë‹¤.</p>
      <ul class="info-stats">
        <li class="list-group-item">ê³„ì•½ BUT ì”ì•¡: <span id="Q3">-</span> BUT</li>
      </ul>
    </div>
  </div>

  <!-- ë³´ë¬¼ ì—´ê¸° -->
  <div class="card mb-4">
    <div class="card-header"><h5>ë³´ë¬¼ ì—´ê¸°</h5></div>
    <div class="card-body">
      <p>ë³´ë¬¼ ì½”ë“œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ QRì½”ë“œë¥¼ ìŠ¤ìº”í•´ ë°•ìŠ¤ë¥¼ ì—¬ì„¸ìš”.</p>

      <div class="input-group mb-3">
        <input type="text" id="qrIdInput" class="form-control" placeholder="ë³´ë¬¼ ì½”ë“œ ì…ë ¥">
        <button class="btn btn-primary" onclick="onClickOpenBox()">ë³´ë¬¼ë°•ìŠ¤ì—´ê¸°</button>
      </div>

      <div class="mb-3">
        <button class="btn btn-secondary" onclick="startQrScanner()">ğŸ“· QR ì½”ë“œ ìŠ¤ìº”</button>
      </div>
      <div id="qr-reader" style="width: 100%; max-width: 300px;"></div>
    </div>
  </div>

  <!-- ë‚´ê°€ ì°¾ì€ ë³´ë¬¼ -->
  <div class="card mb-4">
    <div class="card-header"><h5>ë‚´ê°€ ì°¾ì€ ë³´ë¬¼</h5></div>
    <div class="card-body">
      <button class="btn btn-outline-success mb-3" onclick="Mystatus()">ì§€ê°‘ ì—°ê²°</button>
      <ul class="list-group">
        <li class="list-group-item">ë£¨ë¹„: <span id="Luby">-</span>ê°œ</li>
        <li class="list-group-item">ì‚¬íŒŒì´ì–´: <span id="Sapp">-</span>ê°œ</li>
        <li class="list-group-item">ì—ë©”ë„ë“œ: <span id="Emer">-</span>ê°œ</li>
        <button class="btn btn-primary mt-3" onclick="Openbox1()">ë³´ë¬¼êµí™˜</button>
        <li class="list-group-item">í† íŒŒì¦ˆ: <span id="Topa">-</span>ê°œ</li>
        <li class="list-group-item">ë‹¤ì´ì•„: <span id="Dia">-</span>ê°œ</li>
        <li class="list-group-item">ê³¨ë“œë°”: <span id="Gold">-</span>ê°œ</li>
        <button class="btn btn-primary mt-3" onclick="Openbox2()">ë³´ë¬¼êµí™˜</button>
      </ul>
    </div>
  </div>

</div>

<!-- Footer -->
<div id="footer"></div>
<script>
  fetch('../footer.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('footer').innerHTML = html;
    });
</script>

<!-- ê¸°ë³¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.2.0/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="../src/treasure.js"></script>

<!-- âœ… ë³´ë¬¼ë°•ìŠ¤ ì—´ê¸° ë™ì‘ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
function onClickOpenBox() {
  const input = document.getElementById("qrIdInput").value.trim();

  if (!input) {
    alert("ë³´ë¬¼ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  const qrId = parseInt(input.replace(/\D/g, ""), 10);
  if (isNaN(qrId)) {
    alert("ìœ íš¨í•œ ìˆ«ì ì½”ë“œê°€ ì•„ë‹™ë‹ˆë‹¤.");
    return;
  }

  claimTreasure(qrId); // âœ… ë³´ë¬¼ë°•ìŠ¤ ì—´ê¸° ì‹¤í–‰
}
</script>

<!-- âœ… QR ì½”ë“œ ìŠ¤ìº” í›„ ìë™ ì…ë ¥ + ì‹¤í–‰ -->
<script>
function startQrScanner() {
  const scanner = new Html5Qrcode("qr-reader");

  scanner.start(
    { facingMode: "environment" },
    {
      fps: 10,
      qrbox: { width: 250, height: 250 }
    },
    qrMessage => {
      scanner.stop().then(() => {
        document.getElementById("qr-reader").innerHTML = "";
        const cleanId = parseInt(qrMessage.replace(/\D/g, ""), 10);

        if (!isNaN(cleanId)) {
          document.getElementById("qrIdInput").value = cleanId;
          alert("âœ… QR ì¸ì‹ ì„±ê³µ: " + cleanId);
          claimTreasure(cleanId); // âœ… ìë™ ì‹¤í–‰
        } else {
