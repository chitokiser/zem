<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì§‘ë‚˜ê°„ ê°•ì•„ì§€ ì°¾ê¸°</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .card-body.text-center {
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 12px;
      max-width: 360px;
      width: 90%;
      margin: 16px 0;
      padding: 16px;
      text-align: center;
    }
    #map {
      width: 100%;
      height: 200px;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    img.dog-img {
      width: 100%;
      max-width: 280px;
      height: auto;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    button {
      padding: 12px 24px;
      border: none;
      background: #4CAF50;
      color: #fff;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:active {
      transform: scale(0.98);
    }
    p {
      margin: 8px 0;
      color: #555;
    }
  </style>
  <!-- TODO: YOUR_API_KEY ë¶€ë¶„ì„ ë°œê¸‰ë°›ì€ Google Maps API í‚¤ë¡œ êµì²´í•˜ì„¸ìš” -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
</head>
<body>

  <!-- 1) ì§€ë„ ì„¤ì • ì¹´ë“œ -->
  <div class="card-body text-center">
    <h3>ğŸ¾ ê°•ì•„ì§€ ìœ„ì¹˜ ì„¤ì •</h3>
    <div id="map"></div>
    <p id="coordInfo">ì§€ë„ë¥¼ í„°ì¹˜í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
  </div>

  <!-- 2) ë°œê²¬ ë©”ì‹œì§€/ì´ë¯¸ì§€ ì¹´ë“œ -->
  <div id="message" class="card-body text-center">
    <p>í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤â€¦</p>
  </div>

  <script>
    let map, marker;
    // ì‚¬ìš©ìê°€ ì„¤ì •í•œ ëª©í‘œ ì§€ì 
    let target = null;
    // ë°œê²¬ ì„ê³„ê°’ (ì•½ 50m ì´ë‚´)
    const threshold = 0.0005;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 37.5665, lng: 126.9780 },
        zoom: 14,
        disableDefaultUI: true
      });

      // ì§€ë„ í´ë¦­ ì‹œ ë§ˆì»¤ ìƒì„± ë° ëª©í‘œ ì¢Œí‘œ ì €ì¥
      map.addListener('click', e => {
        const lat = e.latLng.lat();
        const lng = e.latLng.lng();
        target = { lat, lng };
        // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
        if (marker) marker.setMap(null);
        // ìƒˆ ë§ˆì»¤ í‘œì‹œ
        marker = new google.maps.Marker({
          position: e.latLng,
          map: map,
          title: 'ê°•ì•„ì§€ ìœ„ì¹˜'
        });
        document.getElementById('coordInfo')
          .textContent = `ì„ íƒëœ ìœ„ì¹˜: (${lat.toFixed(5)}, ${lng.toFixed(5)})`;
      });
    }

    // ìœ„ì¹˜ í™•ì¸ ë° íƒìƒ‰
    function getLocation() {
      const msgDiv = document.getElementById('message');
      if (!navigator.geolocation) {
        msgDiv.innerHTML = '<p>ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      if (!target) {
        msgDiv.innerHTML = '<p>ë¨¼ì € ê°•ì•„ì§€ ìœ„ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>';
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude } = pos.coords;
          // ì‚¬ìš©ì ìœ„ì¹˜ì™€ ëª©í‘œ ìœ„ì¹˜ ë¹„êµ
          if (
            Math.abs(latitude  - target.lat) < threshold &&
            Math.abs(longitude - target.lng) < threshold
          ) {
            showDog();
          } else {
            msgDiv.innerHTML = '<p>ê°•ì•„ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë” ê°€ê¹Œì´ ì´ë™í•´ì£¼ì„¸ìš”.</p>';
          }
        },
        () => {
          msgDiv.innerHTML = '<p>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
        }
      );
    }

    // ê°•ì•„ì§€ ì´ë¯¸ì§€ì™€ ë³´ìƒ ë²„íŠ¼ í‘œì‹œ
    function showDog() {
      const msgDiv = document.getElementById('message');
      msgDiv.innerHTML = '';
      const img = document.createElement('img');
      img.src = 'dog.png';  // ì‹¤ì œ ì´ë¯¸ì§€ ê²½ë¡œë¡œ êµì²´
      img.alt = 'ì§‘ë‚˜ê°„ ê°•ì•„ì§€';
      img.className = 'dog-img';
      msgDiv.appendChild(img);

      const btn = document.createElement('button');
      btn.textContent = 'ê°•ì•„ì§€ êµ¬ì¡°í•˜ê¸°';
      btn.addEventListener('click', () => {
        alert('ğŸ– ê°•ì•„ì§€ ê°„ì‹ 1ê°œ íšë“!');
      });
      msgDiv.appendChild(btn);
    }

    // ì´ˆê¸°í™”
    window.onload = () => {
      initMap();
      getLocation();
      // 30ì´ˆë§ˆë‹¤ ìœ„ì¹˜ ê°±ì‹ 
      setInterval(getLocation, 30_000);
    };
  </script>
</body>
</html>
